<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animated Peas - Y2K Floating Decorations</title>
    <link rel="stylesheet" href="https://coaiexist.wtf/pea/pea-nav-win1100-FINAL.css">
<script src="https://coaiexist.wtf/pea/pea-nav-win1100-FINAL.js"></script>

</head>
<body>
    <!-- Control Panel -->
    <div class="pea-controls" id="peaControls">
        <div class="control-header">
            <h3>ðŸŸ¢ Pea Chaos Controller</h3>
            <button class="minimize-btn" id="minimizeBtn">âˆ’</button>
        </div>
        <div class="control-content" id="controlContent">
            <div class="control-group">
                <label class="toggle-switch">
                    <input type="checkbox" id="peaToggle" checked>
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Pea Mayhem</span>
                </label>
            </div>
            <div class="control-group">
                <label for="intensitySlider">Pea Intensity:</label>
                <input type="range" id="intensitySlider" min="1" max="12" value="8" class="intensity-slider">
                <span id="intensityValue" class="intensity-display">8</span>
            </div>
            <div class="control-group">
                <button id="glitchBtn" class="glitch-trigger-btn">Trigger Glitch Storm</button>
            </div>
        </div>
    </div>

    <!-- Pea Container -->
    <div class="pea-container" id="peaContainer"></div>

    <!-- Demo Content -->
    <div class="demo-content">
        <h1>Floating Peas Demo</h1>
        <p>This is a demonstration of the animated pea decorative element. The peas float around the screen with Y2K aesthetics, occasional glitch effects, and smooth movements.</p>
        
        <div class="demo-section">
            <h2>Features:</h2>
            <ul>
                <li>8-12 peas floating at various sizes</li>
                <li>Normal green peas &amp; glitchy colorful variants</li>
                <li>Random glitch effects every 5-10 seconds</li>
                <li>Soft glows and transparency effects</li>
                <li>Toggle controls and intensity slider</li>
                <li>Responsive design (fewer peas on mobile)</li>
                <li>Non-intrusive - won't block content</li>
            </ul>
        </div>
        
        <div class="demo-section">
            <h2>Y2K Aesthetic</h2>
            <p>The peas feature glowing effects, cyber colors, and retro-futuristic vibes. Some peas occasionally glitch out with pixelated effects and color shifts.</p>
        </div>
        
        <div class="demo-section">
            <h2>Easy Integration</h2>
            <p>This element can be easily embedded into any page. Just include the HTML structure and CSS/JS, then initialize the peas!</p>
        </div>
    </div>

    <style>
        /* Design System Variables */
        :root {
            /* Primitive Color Tokens */
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-teal-800: rgba(41, 150, 161, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);

            /* RGB versions for opacity control */
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-red-500-rgb: 192, 21, 47;
            --color-red-400-rgb: 255, 84, 89;
            --color-orange-500-rgb: 168, 75, 47;
            --color-orange-400-rgb: 230, 129, 97;

            /* Background color tokens (Light Mode) */
            --color-bg-1: rgba(59, 130, 246, 0.08);
            --color-bg-2: rgba(245, 158, 11, 0.08);
            --color-bg-3: rgba(34, 197, 94, 0.08);
            --color-bg-4: rgba(239, 68, 68, 0.08);
            --color-bg-5: rgba(147, 51, 234, 0.08);
            --color-bg-6: rgba(249, 115, 22, 0.08);
            --color-bg-7: rgba(236, 72, 153, 0.08);
            --color-bg-8: rgba(6, 182, 212, 0.08);

            /* Semantic Color Tokens (Light Mode) */
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
            --color-warning: var(--color-orange-500);
            --color-info: var(--color-slate-500);
            --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
            --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

            /* Pea-specific colors */
            --pea-green-normal: #8BC34A;
            --pea-green-bright: #4CAF50;
            --pea-glitch-purple: #9C27B0;
            --pea-glitch-pink: #E91E63;
            --pea-glitch-cyan: #00BCD4;
            
            /* Typography */
            --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            --font-size-xs: 11px;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-md: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --font-size-4xl: 30px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 550;
            --font-weight-bold: 600;
            --line-height-tight: 1.2;
            --line-height-normal: 1.5;
            --letter-spacing-tight: -0.01em;

            /* Spacing */
            --space-0: 0;
            --space-1: 1px;
            --space-2: 2px;
            --space-4: 4px;
            --space-6: 6px;
            --space-8: 8px;
            --space-10: 10px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;

            /* Border Radius */
            --radius-sm: 6px;
            --radius-base: 8px;
            --radius-md: 10px;
            --radius-lg: 12px;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
            --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);

            /* Animation */
            --duration-fast: 150ms;
            --duration-normal: 250ms;
            --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

            /* Layout */
            --container-sm: 640px;
            --container-md: 768px;
            --container-lg: 1024px;
            --container-xl: 1280px;
        }

        /* Dark mode colors */
        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb, 167, 169, 169), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-primary-active: var(--color-teal-800);
                --color-secondary: rgba(var(--color-gray-400-rgb, 119, 124, 124), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb, 119, 124, 124), 0.25);
                --color-secondary-active: rgba(var(--color-gray-400-rgb, 119, 124, 124), 0.3);
                --color-border: rgba(var(--color-gray-400-rgb, 119, 124, 124), 0.3);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb, 119, 124, 124), 0.2);
                --color-card-border-inner: rgba(var(--color-gray-400-rgb, 119, 124, 124), 0.15);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
                --color-warning: var(--color-orange-400);
                --color-info: var(--color-gray-300);
                --color-focus-ring: rgba(var(--color-teal-300-rgb, 50, 184, 198), 0.4);
                --color-select-caret: rgba(var(--color-gray-200-rgb, 245, 245, 245), 0.8);
            }
        }

        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: var(--font-size-base);
            font-family: var(--font-family-base);
            line-height: var(--line-height-normal);
            color: var(--color-text);
            background-color: var(--color-background);
        }

        body {
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Pea Container - Fixed positioned overlay */
        .pea-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }

        /* Individual Pea Styles */
        .pea {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .pea.hidden {
            opacity: 0;
        }

        /* Pea variants by size */
        .pea.small {
            width: 20px;
            height: 20px;
        }

        .pea.medium {
            width: 35px;
            height: 35px;
        }

        .pea.large {
            width: 50px;
            height: 50px;
        }

        /* Pea color variants */
        .pea.normal-green {
            background: var(--pea-green-normal);
            box-shadow: 0 0 15px rgba(139, 195, 74, 0.4);
        }

        .pea.bright-green {
            background: var(--pea-green-bright);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
        }

        .pea.glitch-purple {
            background: var(--pea-glitch-purple);
            box-shadow: 0 0 25px rgba(156, 39, 176, 0.6);
        }

        .pea.glitch-pink {
            background: var(--pea-glitch-pink);
            box-shadow: 0 0 25px rgba(233, 30, 99, 0.6);
        }

        .pea.glitch-cyan {
            background: var(--pea-glitch-cyan);
            box-shadow: 0 0 25px rgba(0, 188, 212, 0.6);
        }

        /* Pea animations */
        .pea.floating {
            animation: float 30s linear infinite;
        }

        .pea.drifting {
            animation: drift 20s linear infinite;
        }

        .pea.zipping {
            animation: zip 12s linear infinite;
        }

        .pea.pulsing {
            animation: pulse 3s ease-in-out infinite;
        }

        .pea.glitching {
            animation: glitch 0.5s ease-in-out;
        }

        .pea.trailing::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, currentColor 0%, transparent 50%);
            opacity: 0.3;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: trail 2s ease-out infinite;
        }

        /* Keyframe animations */
        @keyframes float {
            0% {
                transform: translateX(-50px) translateY(100vh) rotate(0deg);
            }
            100% {
                transform: translateX(calc(100vw + 50px)) translateY(-50px) rotate(360deg);
            }
        }

        @keyframes drift {
            0% {
                transform: translateX(100vw) translateY(100vh) rotate(0deg);
            }
            25% {
                transform: translateX(75vw) translateY(25vh) rotate(90deg);
            }
            50% {
                transform: translateX(25vw) translateY(75vh) rotate(180deg);
            }
            75% {
                transform: translateX(50vw) translateY(10vh) rotate(270deg);
            }
            100% {
                transform: translateX(-50px) translateY(50vh) rotate(360deg);
            }
        }

        @keyframes zip {
            0% {
                transform: translateX(-50px) translateY(50vh) rotate(0deg) scale(1);
            }
            10% {
                transform: translateX(20vw) translateY(30vh) rotate(36deg) scale(0.8);
            }
            20% {
                transform: translateX(80vw) translateY(70vh) rotate(144deg) scale(1.2);
            }
            30% {
                transform: translateX(60vw) translateY(20vh) rotate(216deg) scale(0.9);
            }
            50% {
                transform: translateX(40vw) translateY(80vh) rotate(288deg) scale(1.1);
            }
            80% {
                transform: translateX(90vw) translateY(40vh) rotate(432deg) scale(0.7);
            }
            100% {
                transform: translateX(calc(100vw + 50px)) translateY(60vh) rotate(720deg) scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.3);
                opacity: 0.9;
                filter: brightness(1.2);
            }
        }

        @keyframes glitch {
            0%, 100% {
                transform: translate(0, 0) scale(1);
                filter: hue-rotate(0deg);
            }
            10% {
                transform: translate(-2px, 2px) scale(1.1);
                filter: hue-rotate(90deg);
            }
            20% {
                transform: translate(2px, -2px) scale(0.9);
                filter: hue-rotate(180deg);
            }
            30% {
                transform: translate(-1px, -1px) scale(1.2);
                filter: hue-rotate(270deg) blur(1px);
            }
            40% {
                transform: translate(1px, 1px) scale(0.8);
                filter: hue-rotate(360deg);
            }
            60% {
                transform: translate(-2px, 1px) scale(1.1);
                filter: hue-rotate(180deg) saturate(2);
            }
            80% {
                transform: translate(2px, -1px) scale(0.9);
                filter: hue-rotate(90deg);
            }
        }

        @keyframes trail {
            0% {
                opacity: 0.3;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(2);
            }
        }

        /* Control Panel Styles */
        .pea-controls {
            position: fixed;
            top: var(--space-20);
            right: var(--space-20);
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            min-width: 250px;
            backdrop-filter: blur(10px);
        }

        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-12) var(--space-16);
            background: var(--color-bg-3);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            border-bottom: 1px solid var(--color-card-border-inner);
        }

        .control-header h3 {
            margin: 0;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }

        .minimize-btn {
            background: none;
            border: none;
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--space-4);
            border-radius: var(--radius-sm);
            transition: background-color var(--duration-fast) var(--ease-standard);
        }

        .minimize-btn:hover {
            background: var(--color-secondary-hover);
        }

        .control-content {
            padding: var(--space-16);
            display: block;
        }

        .control-content.minimized {
            display: none;
        }

        .control-group {
            margin-bottom: var(--space-16);
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        /* Toggle Switch */
        .toggle-switch {
            display: flex;
            align-items: center;
            gap: var(--space-12);
            cursor: pointer;
        }

        .toggle-switch input[type="checkbox"] {
            display: none;
        }

        .toggle-slider {
            position: relative;
            width: 48px;
            height: 24px;
            background: var(--color-secondary);
            border-radius: var(--radius-full);
            transition: background-color var(--duration-normal) var(--ease-standard);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: var(--color-surface);
            border-radius: 50%;
            transition: transform var(--duration-normal) var(--ease-standard);
            box-shadow: var(--shadow-sm);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--color-primary);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(24px);
        }

        .toggle-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
        }

        /* Intensity Slider */
        .control-group label {
            display: block;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
            margin-bottom: var(--space-8);
        }

        .intensity-slider {
            width: 100%;
            height: 6px;
            background: var(--color-secondary);
            border-radius: var(--radius-sm);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .intensity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--color-primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
        }

        .intensity-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--color-primary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: var(--shadow-sm);
        }

        .intensity-display {
            display: inline-block;
            margin-left: var(--space-8);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            min-width: 20px;
        }

        /* Glitch Trigger Button */
        .glitch-trigger-btn {
            width: 100%;
            padding: var(--space-8) var(--space-12);
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
            border: none;
            border-radius: var(--radius-base);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: background-color var(--duration-fast) var(--ease-standard);
        }

        .glitch-trigger-btn:hover {
            background: var(--color-primary-hover);
        }

        .glitch-trigger-btn:active {
            background: var(--color-primary-active);
        }

        /* Demo Content Styles */
        .demo-content {
            max-width: var(--container-md);
            margin: 0 auto;
            padding: var(--space-32) var(--space-20);
            position: relative;
            z-index: 1;
        }

        .demo-content h1 {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin-bottom: var(--space-24);
            text-align: center;
        }

        .demo-content p {
            font-size: var(--font-size-lg);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-24);
            line-height: var(--line-height-normal);
        }

        .demo-section {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
            margin-bottom: var(--space-24);
        }

        .demo-section h2 {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-16);
        }

        .demo-section ul {
            list-style: none;
            padding: 0;
        }

        .demo-section li {
            position: relative;
            padding-left: var(--space-20);
            margin-bottom: var(--space-8);
            color: var(--color-text-secondary);
        }

        .demo-section li::before {
            content: 'ðŸŸ¢';
            position: absolute;
            left: 0;
            top: 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .pea-controls {
                top: var(--space-10);
                right: var(--space-10);
                min-width: 200px;
            }

            .demo-content {
                padding: var(--space-20) var(--space-16);
            }

            .demo-content h1 {
                font-size: var(--font-size-3xl);
            }
        }

        /* Hide fewer peas on mobile */
        @media (max-width: 480px) {
            .pea.mobile-hidden {
                display: none;
            }
        }
    </style>

    <script>
        class PeaSystem {
            constructor() {
                this.container = document.getElementById('peaContainer');
                this.toggle = document.getElementById('peaToggle');
                this.intensitySlider = document.getElementById('intensitySlider');
                this.intensityValue = document.getElementById('intensityValue');
                this.glitchBtn = document.getElementById('glitchBtn');
                this.minimizeBtn = document.getElementById('minimizeBtn');
                this.controlContent = document.getElementById('controlContent');
                
                this.peas = [];
                this.isActive = true;
                this.intensity = 8;
                this.glitchInterval = null;
                this.isMinimized = false;
                
                this.colors = [
                    { class: 'normal-green', weight: 40 },
                    { class: 'bright-green', weight: 30 },
                    { class: 'glitch-purple', weight: 10 },
                    { class: 'glitch-pink', weight: 10 },
                    { class: 'glitch-cyan', weight: 10 }
                ];
                
                this.sizes = [
                    { class: 'small', weight: 50 },
                    { class: 'medium', weight: 35 },
                    { class: 'large', weight: 15 }
                ];
                
                this.animations = [
                    { class: 'floating', weight: 40 },
                    { class: 'drifting', weight: 40 },
                    { class: 'zipping', weight: 20 }
                ];
                
                this.effects = [
                    { class: 'pulsing', weight: 20 },
                    { class: 'trailing', weight: 15 }
                ];
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.createPeas();
                this.startGlitchCycle();
            }
            
            setupEventListeners() {
                this.toggle.addEventListener('change', () => {
                    this.isActive = this.toggle.checked;
                    this.togglePeas();
                });
                
                this.intensitySlider.addEventListener('input', () => {
                    this.intensity = parseInt(this.intensitySlider.value);
                    this.intensityValue.textContent = this.intensity;
                    this.updatePeaCount();
                });
                
                this.glitchBtn.addEventListener('click', () => {
                    this.triggerGlitchStorm();
                });
                
                this.minimizeBtn.addEventListener('click', () => {
                    this.toggleMinimize();
                });
            }
            
            toggleMinimize() {
                this.isMinimized = !this.isMinimized;
                this.controlContent.classList.toggle('minimized', this.isMinimized);
                this.minimizeBtn.textContent = this.isMinimized ? '+' : 'âˆ’';
            }
            
            getRandomChoice(options) {
                const totalWeight = options.reduce((sum, opt) => sum + opt.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (const option of options) {
                    random -= option.weight;
                    if (random <= 0) {
                        return option.class;
                    }
                }
                
                return options[0].class;
            }
            
            createPea() {
                const pea = document.createElement('div');
                pea.className = 'pea';
                
                // Add size class
                const size = this.getRandomChoice(this.sizes);
                pea.classList.add(size);
                
                // Add color class
                const color = this.getRandomChoice(this.colors);
                pea.classList.add(color);
                
                // Add animation class
                const animation = this.getRandomChoice(this.animations);
                pea.classList.add(animation);
                
                // Random chance for special effects
                if (Math.random() < 0.3) {
                    const effect = this.getRandomChoice(this.effects);
                    pea.classList.add(effect);
                }
                
                // Mobile responsiveness - hide some peas on small screens
                if (window.innerWidth <= 480 && Math.random() < 0.4) {
                    pea.classList.add('mobile-hidden');
                }
                
                // Random starting position and delay
                const startDelay = Math.random() * 10; // 0-10 seconds
                pea.style.animationDelay = `${startDelay}s`;
                
                // Random starting position for some animations
                if (animation === 'drifting') {
                    pea.style.top = Math.random() * 100 + 'vh';
                    pea.style.left = Math.random() * 100 + 'vw';
                } else {
                    pea.style.top = Math.random() * 100 + 'vh';
                }
                
                this.container.appendChild(pea);
                
                // Remove pea after animation completes to prevent memory leaks
                const animationDuration = animation === 'floating' ? 30000 : 
                                        animation === 'drifting' ? 20000 : 12000;
                
                setTimeout(() => {
                    if (pea.parentNode) {
                        this.container.removeChild(pea);
                        const index = this.peas.indexOf(pea);
                        if (index > -1) {
                            this.peas.splice(index, 1);
                        }
                    }
                }, animationDuration + startDelay * 1000);
                
                return pea;
            }
            
            createPeas() {
                // Clear existing peas
                this.clearPeas();
                
                if (!this.isActive) return;
                
                // Create peas based on intensity
                for (let i = 0; i < this.intensity; i++) {
                    setTimeout(() => {
                        if (this.isActive) {
                            const pea = this.createPea();
                            this.peas.push(pea);
                        }
                    }, i * 500); // Stagger creation
                }
                
                // Continue creating new peas to replace ones that finish
                if (this.isActive) {
                    setTimeout(() => {
                        this.createPeas();
                    }, 15000); // Create new batch every 15 seconds
                }
            }
            
            clearPeas() {
                this.peas.forEach(pea => {
                    if (pea.parentNode) {
                        this.container.removeChild(pea);
                    }
                });
                this.peas = [];
            }
            
            togglePeas() {
                if (this.isActive) {
                    this.peas.forEach(pea => {
                        pea.classList.remove('hidden');
                    });
                    this.createPeas();
                } else {
                    this.peas.forEach(pea => {
                        pea.classList.add('hidden');
                    });
                }
            }
            
            updatePeaCount() {
                if (this.isActive) {
                    this.createPeas();
                }
            }
            
            triggerGlitch(pea) {
                if (!pea || !pea.parentNode) return;
                
                pea.classList.add('glitching');
                
                // Random chance to clone the pea for multiply effect
                if (Math.random() < 0.3) {
                    const clone = pea.cloneNode(true);
                    clone.style.left = (parseInt(pea.style.left) || 0) + (Math.random() - 0.5) * 100 + 'px';
                    clone.style.top = (parseInt(pea.style.top) || 0) + (Math.random() - 0.5) * 100 + 'px';
                    clone.style.opacity = '0.6';
                    this.container.appendChild(clone);
                    
                    setTimeout(() => {
                        if (clone.parentNode) {
                            this.container.removeChild(clone);
                        }
                    }, 1000);
                }
                
                setTimeout(() => {
                    pea.classList.remove('glitching');
                }, 500);
            }
            
            triggerGlitchStorm() {
                const activePeas = this.peas.filter(pea => pea.parentNode && !pea.classList.contains('hidden'));
                const peaCount = Math.min(activePeas.length, 5);
                
                for (let i = 0; i < peaCount; i++) {
                    setTimeout(() => {
                        const randomPea = activePeas[Math.floor(Math.random() * activePeas.length)];
                        this.triggerGlitch(randomPea);
                    }, i * 100);
                }
            }
            
            startGlitchCycle() {
                const scheduleNextGlitch = () => {
                    const delay = (Math.random() * 5 + 5) * 1000; // 5-10 seconds
                    
                    setTimeout(() => {
                        if (this.isActive && this.peas.length > 0) {
                            const activePeas = this.peas.filter(pea => pea.parentNode && !pea.classList.contains('hidden'));
                            if (activePeas.length > 0) {
                                const randomPea = activePeas[Math.floor(Math.random() * activePeas.length)];
                                this.triggerGlitch(randomPea);
                            }
                        }
                        scheduleNextGlitch();
                    }, delay);
                };
                
                scheduleNextGlitch();
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new PeaSystem();
        });
        
        // Handle window resize for responsiveness
        window.addEventListener('resize', () => {
            // You could implement dynamic pea count adjustment here if needed
        });
    </script>
</body>
</html>