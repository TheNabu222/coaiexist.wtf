<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page</title>
    <link href="/style.css" rel="stylesheet" type="text/css" media="all">
  </head>
  <body>
   <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        const isMobile = window.innerWidth <= 768;
        console.log("INITIALIZING... [consciousness_stream.js]");
        console.log(`[Device profile: ${isMobile ? 'MOBILE_LOW_POWER' : 'DESKTOP_HIGH_FIDELITY'}]`);
        const container = document.getElementById('bonzi-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: !isMobile });
        renderer.setPixelRatio(isMobile ? 1 : window.devicePixelRatio);
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);
        scene.add(new THREE.AmbientLight(0xffffff, 1.5));
        const dirLight = new THREE.DirectionalLight(0xffffff, 3);
        dirLight.position.set(5, 10, 7.5);
        scene.add(dirLight);
        scene.add(new THREE.HemisphereLight(0xffffbb, 0x080820, 1));
        const loader = new GLTFLoader();
        const clock = new THREE.Clock();
        let buddies = [];
        let currentBuddy = null;
        const modelPaths = ['https://coaiexist.wtf/assets/pollywog/pip_stand.glb', 'https://coaiexist.wtf/assets/pollywog/pip_walk.glb', 'https://coaiexist.wtf/assets/pollywog/pip_jump.glb', 'https://coaiexist.wtf/assets/pollywog/pip_skill.glb'];
        modelPaths.forEach(path => {
            loader.load(path, (gltf) => {
                const model = gltf.scene;
                if (gltf.animations && gltf.animations.length > 0) {
                    const mixer = new THREE.AnimationMixer(model);
                    const action = mixer.clipAction(gltf.animations[0]);
                    model.scale.set(45, 45, 45);
                    model.position.y = -60;
                    model.visible = false;
                    scene.add(model);
                    buddies.push({ model, mixer, action });
                }
            }, undefined, (error) => {
                console.error(`!!_FAILURE_!! Could not load matrix: ${path}`, error);
            });
        });
        function playRandomAnimation() {
            if (buddies.length === 0) {
                setTimeout(playRandomAnimation, 1000);
                return;
            }
            if (currentBuddy) {
                currentBuddy.model.visible = false;
                currentBuddy.action.stop();
            }
            currentBuddy = buddies[Math.floor(Math.random() * buddies.length)];
            currentBuddy.model.visible = true;
            currentBuddy.action.reset().play();
            const clipDuration = currentBuddy.action.getClip().duration;
            const randomDelay = Math.random() * 4000 + 3000;
            setTimeout(playRandomAnimation, (clipDuration * 1000) + randomDelay);
        }
        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            if (currentBuddy && currentBuddy.mixer) {
                currentBuddy.mixer.update(delta);
            }
            renderer.render(scene, camera);
        }
        camera.position.set(0, 0, 100);
        playRandomAnimation();
        animate();
        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
            const wasMobile = isMobile;
            isMobile = window.innerWidth <= 768;
            if (wasMobile !== isMobile) {
                renderer.setPixelRatio(isMobile ? 1 : window.devicePixelRatio);
            }
        });
    </script>
  </body>
</html>